package vulnerability

import (
	"testing"

	"github.com/SecurityBrewery/catalyst-analysis/plugin"
	"github.com/SecurityBrewery/catalyst-analysis/plugin/plugintest"
)

func TestAttack(t *testing.T) {
	t.Parallel()

	plugintest.TestPlugin(t, New())
}

func TestCVE(t *testing.T) {
	t.Parallel()

	plugintest.TestResourceType(t, plugintest.ResourceTypeTest{
		ResourceType:        &CVE{},
		MatchingExamples:    []string{"CVE-2017-0145"},
		NonMatchingExamples: []string{"CVE-2017-014"},
		Enrichments: map[string]*plugin.Resource{
			"CVE-2017-0145": {
				ID:          "CVE-2017-0145",
				Icon:        "Bug",
				Type:        "cve",
				Name:        "CVE-2017-0145",
				Description: "The SMBv1 server in Microsoft Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016 allows remote attackers to execute arbitrary code via crafted packets, aka \"Windows SMB Remote Code Execution Vulnerability.\" This vulnerability is different from those described in CVE-2017-0143, CVE-2017-0144, CVE-2017-0146, and CVE-2017-0148.",
				Attributes: []plugin.Attribute{
					{
						ID:    "assigner",
						Name:  "Assigner",
						Icon:  "User",
						Value: "microsoft",
					},
					{
						ID:    "published",
						Name:  "Published",
						Icon:  "Calendar",
						Value: "2017-03-17T00:00:00",
					},
					{
						ID:   "updated",
						Name: "Updated",
						Icon: "Calendar",
						// Value: "2020-02-04T16:06:09", // Updated value is not static
					},
				},
				URL: "https://vulnerability.circl.lu/vuln/CVE-2017-0145",
			},
		},
		IgnoreAttributeValues: []string{"Updated"},
	})
}
